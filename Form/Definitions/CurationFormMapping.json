{
  "metadata": {
    "description": "Field mapping from CellLineCurationForm to Pydantic data dictionary.",
    "version": "1.0",
    "note": "The pydantic data dictionary is the source of truth for the ASCR metadata standards."
  },
  "direct_mappings": {
    "cell_line_id": {
      "entity": "CellLine",
      "field": "cell_line_id",
      "type": "string",
      "required": true,
      "note": "Primary key - auto-generate if empty"
    },
    "cell_line_alt_name": {
      "entity": "CellLine",
      "field": "cell_line_alt_name",
      "type": "string",
      "required": true
    },
    "hpscreg_name": {
      "entity": "CellLine",
      "field": "hpscreg_name",
      "type": "string",
      "required": true
    },
    "cell_type": {
      "entity": "CellLine",
      "field": "cell_type",
      "type": "enum",
      "values": [
        "iPSC",
        "ESC"
      ],
      "required": true
    },
    "status": {
      "entity": "CellLine",
      "field": "status",
      "type": "enum",
      "values": [
        "backup",
        "characterised"
      ],
      "required": false
    },
    "clinical_use": {
      "entity": "CellLine",
      "field": "clinical_use",
      "type": "boolean",
      "required": true
    },
    "commercial_use": {
      "entity": "CellLine",
      "field": "commercial_use",
      "type": "boolean",
      "required": true
    },
    "research_use": {
      "entity": "CellLine",
      "field": "research_use",
      "type": "boolean",
      "required": true
    },
    "publish": {
      "entity": "CellLine",
      "field": "publish",
      "type": "boolean",
      "required": true
    },
    "registered_with_hpscreg": {
      "entity": "CellLine",
      "field": "registered_with_hpscreg",
      "type": "boolean",
      "required": true
    },
    "embargo_date": {
      "entity": "CellLine",
      "field": "embargo_date",
      "type": "date",
      "required": false
    },
    "frozen": {
      "entity": "CellLine",
      "field": "frozen",
      "type": "boolean",
      "required": false
    },
    "associated_polymorphism": {
      "entity": "CellLine",
      "field": "associated_polymorphism",
      "type": "ontology",
      "required": true
    },
    "biopsy_location": {
      "entity": "CellLine",
      "field": "biopsy_location",
      "type": "ontology",
      "required": true
    },
    "genotype": {
      "entity": "CellLine",
      "field": "genotype",
      "type": "enum",
      "values": [
        "patient control",
        "gene-corrected"
      ],
      "required": false
    },
    "genotype_locus": {
      "entity": "CellLine",
      "field": "genotype_locus",
      "type": "ontology",
      "required": false
    }
  },
  "renamed_mappings": {
    "donor_age": {
      "entity": "DonorSource",
      "field": "age",
      "type": "enum",
      "values": [
        "Embryonic",
        "Fetal",
        "Neonate",
        "1-4",
        "5-9",
        "10-14",
        "15-19",
        "20-24",
        "25-29",
        "30-34",
        "35-39",
        "40-44",
        "45-49",
        "50-54",
        "55-59",
        "60-64",
        "65-69",
        "70-74",
        "75-79",
        "80-84",
        "85-89",
        "89+"
      ],
      "required": false
    },
    "donor_sex": {
      "entity": "DonorSource",
      "field": "sex",
      "type": "enum",
      "values": [
        "Male",
        "Female",
        "Unknown"
      ],
      "required": true
    },
    "donor_disease_phenotype": {
      "entity": "DonorSource",
      "field": "disease_phenotype",
      "type": "ontology",
      "required": true,
      "note": "Form uses 'donor_disease_phenotype' but maps to 'disease_phenotype' in DonorSource"
    },
    "donor_polymorphism": {
      "entity": "DonorSource",
      "field": "polymorphism",
      "type": "string",
      "required": true,
      "note": "Form uses 'donor_polymorphism' but maps to 'polymorphism' in DonorSource"
    }
  },
  "object_mappings": {
    "ipsc_derivation": {
      "entity": "CellLineDerivedInducedPluripotent",
      "type": "object",
      "required": false,
      "note": "Complete iPSC derivation object - use when cell_type is 'iPSC'"
    },
    "esc_derivation": {
      "entity": "CellLineDerivationEmbryonic",
      "type": "object",
      "required": false,
      "note": "Complete ESC derivation object - use when cell_type is 'ESC'"
    },
    "ethics": {
      "entity": "Ethics",
      "type": "object",
      "required": false,
      "note": "Ethics approval information"
    }
  },
  "list_mappings": {
    "diseases": {
      "entity": "Disease",
      "relationship": "one_to_many",
      "junction_table": "DonorDisease",
      "type": "object_list",
      "note": "List of Disease objects, linked via DonorDisease junction table"
    },
    "genomic_characterisations": {
      "entity": "GenomicCharacterisation",
      "relationship": "one_to_many",
      "foreign_key": "cell_line_id",
      "type": "object_list"
    },
    "additional_genomic_characterisations": {
      "entity": "AdditionalGenomicCharacterisation",
      "relationship": "one_to_many",
      "foreign_key": "genomiccharacterisation_id",
      "type": "object_list"
    },
    "hla_results": {
      "entity": "HlaResults",
      "relationship": "one_to_many",
      "foreign_key": "additionalgenomiccharacterisation_id",
      "type": "object_list"
    },
    "str_fingerprinting_results": {
      "entity": "StrOrFingerprinting",
      "relationship": "one_to_many",
      "foreign_key": "additionalgenomiccharacterisation_id",
      "type": "object_list"
    },
    "undifferentiated_characterisations": {
      "entity": "UndiferentiatedCharactrisation",
      "relationship": "one_to_many",
      "foreign_key": "cell_line_id",
      "type": "object_list"
    },
    "characterisation_protocol_results": {
      "entity": "CharacterisationProtocolResult",
      "relationship": "one_to_many",
      "foreign_key": "cell_line_id",
      "type": "object_list",
      "note": "Typically contains Ectoderm, Mesoderm, Endoderm results"
    },
    "culture_media": {
      "entity": "CultureMedium",
      "relationship": "one_to_many",
      "foreign_key": "cell_line_id",
      "type": "object_list"
    },
    "screening_results": {
      "entity": "MicrobiologyVirologyScreening",
      "relationship": "one_to_many",
      "foreign_key": "cell_line_id",
      "type": "object_list"
    },
    "generator_institutes": {
      "entity": "Institute",
      "relationship": "many_to_many",
      "junction_table": "Group_Institute",
      "type": "object_list",
      "note": "Institutions that generated the cell line"
    },
    "owner_institutes": {
      "entity": "Institute",
      "relationship": "many_to_many",
      "junction_table": "Group_Institute",
      "type": "object_list",
      "note": "Institutions that own the cell line"
    },
    "contacts": {
      "entity": "Contact",
      "relationship": "one_to_many",
      "foreign_key": "group_id",
      "type": "object_list"
    },
    "publications": {
      "entity": "Publication",
      "relationship": "many_to_many",
      "junction_table": "Cell_Line_Publication",
      "type": "object_list"
    },
    "external_references": {
      "entity": "xRefs",
      "relationship": "one_to_many",
      "foreign_key": "cell_line_id",
      "type": "object_list"
    },
    "synonyms": {
      "entity": "Synonym",
      "relationship": "one_to_many",
      "foreign_key": "cell_line_id",
      "type": "object_list"
    },
    "genomic_modifications": {
      "entity": "GenomicModification",
      "relationship": "one_to_many",
      "foreign_key": "cell_line_id",
      "type": "object_list"
    },
    "genomic_alterations": {
      "entity": "GenomicAlteration",
      "relationship": "one_to_many",
      "type": "object_list",
      "note": "Linked via GenomicModification"
    },
    "integrated_vectors": {
      "entity": "IntegratedVector",
      "relationship": "one_to_many",
      "foreign_key": "derivationipsintegratedvector_id",
      "type": "object_list"
    },
    "non_integrated_vectors": {
      "entity": "NonIntegratedVector",
      "relationship": "one_to_many",
      "foreign_key": "derivationipsintegratedvector_id",
      "type": "object_list"
    },
    "vector_free_reprogramming": {
      "entity": "VectorFreeReprogramming",
      "relationship": "one_to_many",
      "foreign_key": "celllinederivedinducedpluripotent_id",
      "type": "object_list"
    },
    "small_molecules": {
      "entity": "SmallMolecule",
      "relationship": "one_to_many",
      "foreign_key": "vectorfreeprogramming_id",
      "type": "object_list"
    },
    "hpsc_scorecards": {
      "entity": "hpsc_scorecard",
      "relationship": "one_to_many",
      "foreign_key": "cell_line_id",
      "type": "object_list"
    },
    "loci": {
      "entity": "Loci",
      "relationship": "many_to_many",
      "type": "object_list",
      "note": "Genomic loci of interest"
    }
  },
  "convenience_mappings": {
    "simple_disease_name": {
      "target": "diseases[0].name",
      "entity": "Disease",
      "field": "name",
      "type": "string",
      "note": "Creates first Disease object in diseases list"
    },
    "simple_publication_doi": {
      "target": "publications[0].doi",
      "entity": "Publication",
      "field": "doi",
      "type": "url",
      "note": "Creates first Publication object in publications list"
    },
    "simple_publication_pmid": {
      "target": "publications[0].pmid",
      "entity": "Publication",
      "field": "pmid",
      "type": "string",
      "note": "Creates first Publication object in publications list"
    },
    "simple_contact_email": {
      "target": "contacts[0].e_mail",
      "entity": "Contact",
      "field": "e_mail",
      "type": "email",
      "note": "Creates first Contact object in contacts list"
    },
    "simple_generator_institute": {
      "target": "generator_institutes[0].name",
      "entity": "Institute",
      "field": "name",
      "type": "string",
      "note": "Creates first Institute object in generator_institutes list"
    }
  },
  "file_mappings": {
    "vector_map_file_url": {
      "target": "ipsc_derivation.vector_map_file",
      "entity": "CellLineDerivedInducedPluripotent",
      "field": "vector_map_file",
      "type": "file_url"
    },
    "reprogramming_expression_file_url": {
      "target": "ipsc_derivation.reprogramming_expression_silence_file",
      "entity": "CellLineDerivedInducedPluripotent",
      "field": "reprogramming_expression_silence_file",
      "type": "file_url"
    },
    "characterisation_method_file_url": {
      "target": "characterisation_protocol_results[*].method_file",
      "entity": "CharacterisationProtocolResult",
      "field": "method_file",
      "type": "file_url"
    },
    "scorecard_file_url": {
      "target": "hpsc_scorecards[*].scorecard_file",
      "entity": "hpsc_scorecard",
      "field": "scorecard_file",
      "type": "file"
    },
    "karyogram_file_url": {
      "target": "genomic_characterisations[*].karyogram",
      "entity": "GenomicCharacterisation",
      "field": "karyogram",
      "type": "file_url"
    },
    "morphology_file_url": {
      "target": "undifferentiated_characterisations[*].morphology_file",
      "entity": "UndiferentiatedCharactrisation",
      "field": "morphology_file",
      "type": "file"
    },
    "consent_form_file_url": {
      "target": "ethics.consent_form",
      "entity": "Ethics",
      "field": "consent_form",
      "type": "file"
    }
  },
  "meta_fields": {
    "curator_notes": {
      "type": "workflow",
      "note": "Internal curator notes - not stored in main database"
    },
    "curation_date": {
      "type": "workflow",
      "note": "Date of curation - for workflow tracking"
    },
    "curation_status": {
      "type": "workflow",
      "values": [
        "draft",
        "review",
        "approved"
      ],
      "note": "Curation workflow status"
    }
  },
  "ingestion_workflow": {
    "description": "Recommended workflow for ingesting curation form data",
    "steps": [
      "1. Validate all required fields using direct_mappings and renamed_mappings",
      "2. Create or find DonorSource record using renamed_mappings (donor_*)",
      "3. Create main CellLine record using direct_mappings",
      "4. Create single objects (ipsc_derivation, esc_derivation, ethics) if present",
      "5. Process all list_mappings - create related records with proper foreign keys",
      "6. Handle convenience_mappings by creating objects in target lists",
      "7. Process file_mappings by uploading files and storing URLs",
      "8. Update workflow status using meta_fields"
    ],
    "validation_notes": [
      "Check cell_type to determine if ipsc_derivation or esc_derivation should be used",
      "Ensure foreign key relationships are maintained across entities",
      "Handle junction tables for many_to_many relationships",
      "Generate IDs for new records as needed"
    ]
  }
}