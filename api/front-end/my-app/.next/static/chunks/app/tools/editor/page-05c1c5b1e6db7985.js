(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[994],{2636:(e,t,r)=>{Promise.resolve().then(r.bind(r,3671))},3671:(e,t,r)=>{"use strict";r.d(t,{EditorContainer:()=>G});var l=r(5155),s=r(2115);function n(e){let{label:t,placeholder:r,options:n,value:i,onChange:a,isLoading:o=!1,disabled:c=!1,searchable:d=!1}=e,[u,h]=(0,s.useState)(!1),[f,m]=(0,s.useState)(""),g=(0,s.useRef)(null),x=d&&f?n.filter(e=>{var t;return e.label.toLowerCase().includes(f.toLowerCase())||(null==(t=e.subtitle)?void 0:t.toLowerCase().includes(f.toLowerCase()))}):n,p=n.find(e=>e.id===i);(0,s.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&(h(!1),m(""))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let y=e=>{a(e),h(!1),m("")};return(0,l.jsxs)("div",{className:"relative",ref:g,children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,l.jsxs)("button",{type:"button",onClick:()=>!c&&!o&&h(!u),disabled:c||o,className:"relative w-full bg-white border border-gray-300 rounded-md pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm ".concat(c||o?"bg-gray-50 text-gray-400 cursor-not-allowed":"hover:border-gray-400"),children:[(0,l.jsx)("span",{className:"block truncate",children:o?(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Loading..."]}):p?(0,l.jsxs)("span",{children:[p.label,p.subtitle&&(0,l.jsxs)("span",{className:"text-gray-500 ml-1",children:["(",p.subtitle,")"]})]}):(0,l.jsx)("span",{className:"text-gray-400",children:r})}),(0,l.jsx)("span",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-gray-400 transform transition-transform ".concat(u?"rotate-180":""),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),u&&!o&&(0,l.jsxs)("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm",children:[d&&(0,l.jsx)("div",{className:"px-3 py-2 border-b border-gray-200",children:(0,l.jsx)("input",{type:"text",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"Search...",value:f,onChange:e=>m(e.target.value),onClick:e=>e.stopPropagation()})}),0===x.length?(0,l.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:f?"No results found":"No options available"}):x.map(e=>(0,l.jsx)("button",{onClick:()=>y(e.id),className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 focus:outline-none focus:bg-gray-100 ".concat(i===e.id?"bg-blue-50 text-blue-900":"text-gray-900"),children:(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{children:e.label}),e.subtitle&&(0,l.jsx)("div",{className:"text-xs text-gray-500",children:e.subtitle})]})},e.id))]})]})}var i=r(5731);function a(){let[e,t]=(0,s.useState)([]),[r,l]=(0,s.useState)(null),[n,a]=(0,s.useState)(!1),[o,c]=(0,s.useState)(null),d=(0,s.useCallback)(async e=>{a(!0),c(null);try{let r=[],l=i.S.EDITOR.CELLLINES;for(e&&(l+="?curation_source=".concat(encodeURIComponent(e)));l;){let e=await fetch(l);if(!e.ok)throw Error("Failed to fetch cell lines: ".concat(e.statusText));let t=await e.json();t.results?(r=[...r,...t.results],l=t.next):(r=t,l=null)}t(r)}catch(e){c(e instanceof Error?e.message:"Failed to fetch cell lines"),console.error("Error fetching cell lines:",e)}finally{a(!1)}},[]),u=(0,s.useCallback)(async e=>{a(!0),c(null);try{let t=await fetch(i.S.EDITOR.CELLLINE(e));if(!t.ok)throw Error("Failed to fetch cell line: ".concat(t.statusText));let r=await t.json(),s=r.data||r;return s&&!s.id&&s.CellLine_hpscreg_id&&(s.id=s.CellLine_hpscreg_id),l(s),s}catch(e){return c(e instanceof Error?e.message:"Failed to fetch cell line"),console.error("Error fetching cell line:",e),null}finally{a(!1)}},[]),h=(0,s.useCallback)(async(e,t)=>{a(!0);try{let r=await fetch(i.S.EDITOR.CELLLINE(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Failed to save cell line: ".concat(r.statusText));let s=await r.json(),n=s.data||s;return n&&!n.id&&n.CellLine_hpscreg_id&&(n.id=n.CellLine_hpscreg_id),l(n),s}catch(e){throw console.error("Error saving cell line:",e),e}finally{a(!1)}},[]),f=(0,s.useCallback)(async()=>{a(!0),c(null);try{let e=await fetch(i.S.EDITOR.NEW_TEMPLATE);if(!e.ok)throw Error("Failed to fetch template: ".concat(e.statusText));let t=await e.json(),r=t.template||t;return l(r),r}catch(e){return c(e instanceof Error?e.message:"Failed to fetch template"),console.error("Error fetching template:",e),null}finally{a(!1)}},[]);return(0,s.useEffect)(()=>{d()},[d]),{cellLines:e,selectedCellLine:r,isLoading:n,error:o,fetchCellLine:u,saveCellLine:h,getNewTemplate:f,refetch:d,setSelectedCellLine:l}}function o(e,t){let r=c(e),l=c(t);return r&&l?"NOT_SET":r&&!l?"ADDED":!r&&l?"REMOVED":!function e(t,r){if(t===r)return!0;if(null==t||null==r)return t===r;if(typeof t!=typeof r)return!1;if("object"==typeof t){if(Array.isArray(t)!==Array.isArray(r))return!1;if(Array.isArray(t))return t.length===r.length&&t.every((t,l)=>e(t,r[l]));let l=Object.keys(t),s=Object.keys(r);return l.length===s.length&&l.every(l=>s.includes(l)&&e(t[l],r[l]))}return!1}(e,t)?"MODIFIED":"UNCHANGED"}function c(e){return null==e||""===e||Array.isArray(e)&&0===e.length||"object"==typeof e&&null!==e&&0===Object.keys(e).length}function d(e,t,r){var l,s;let n=(null==e?void 0:e.metadata)||e||{},i=(null==t?void 0:t.metadata)||t||{},a=r||function(e){let t=[];if(!e||"object"!=typeof e)return t;for(let r of Object.keys(e).sort()){if(["success","version_number","performance","created_on","created_by","change_summary"].includes(r))continue;let l=e[r],s=function e(t,r,l){var s;let n={key:t,path:r,type:null==(s=l)?"string":"boolean"==typeof s?"boolean":"number"==typeof s?"number":Array.isArray(s)?"array":"object"==typeof s?"object":"string",label:t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).replace(/_/g," ").trim()};if("object"===n.type&&l&&"object"==typeof l&&!Array.isArray(l)&&(n.children=Object.keys(l).sort().map(t=>e(t,"".concat(r,".").concat(t),l[t]))),"array"===n.type&&Array.isArray(l)&&l.length>0){let t=l[0];"object"==typeof t&&null!==t&&(n.itemSchema=Object.keys(t).sort().map(l=>e(l,"".concat(r,"[].").concat(l),t[l])))}return n}(r,r,l);t.push(s)}return t}({...n,...i});return l=n,s=i,a.map(e=>{let t=u(l,e.path),r=u(s,e.path);return function e(t,r,l){var s,n,i,a;let c=o(r,l);return"object"===t.type?function(t,r,l){var s;let n=(null==(s=t.children)?void 0:s.map(t=>{var s,n;let i=null!=(s=null==r?void 0:r[t.key])?s:null,a=null!=(n=null==l?void 0:l[t.key])?n:null;return e(t,i,a)}))||[],i=n.some(e=>"UNCHANGED"!==e.changeType&&"NOT_SET"!==e.changeType),a=o(r,l);return{fieldPath:t.path,changeType:i?"MODIFIED":a,leftValue:r,rightValue:l,hasNestedChanges:i,children:n}}(t,r,l):"array"===t.type?function(e,t,r){let l=t||[],s=r||[],n=Math.max(l.length,s.length),i=[];for(let t=0;t<n;t++){let r=t<l.length?l[t]:null,n=t<s.length?s[t]:null,a={fieldPath:"".concat(e.path,"[").concat(t,"]"),changeType:o(r,n),leftValue:r,rightValue:n};e.itemSchema&&(r||n)&&(a.children=e.itemSchema.map(l=>{var s,i;let a=null!=(s=null==r?void 0:r[l.key])?s:null,c=null!=(i=null==n?void 0:n[l.key])?i:null;return{fieldPath:"".concat(e.path,"[").concat(t,"].").concat(l.key),changeType:o(a,c),leftValue:a,rightValue:c}}),a.children.some(e=>"UNCHANGED"!==e.changeType&&"NOT_SET"!==e.changeType)&&"UNCHANGED"===a.changeType&&(a.changeType="MODIFIED",a.hasNestedChanges=!0)),i.push(a)}let a=i.some(e=>"UNCHANGED"!==e.changeType&&"NOT_SET"!==e.changeType);return{fieldPath:e.path,changeType:a?"MODIFIED":o(l,s),leftValue:l,rightValue:s,hasNestedChanges:a,children:i}}(t,r,l):(s=t,n=r,i=l,a=c,{fieldPath:s.path,changeType:a,leftValue:n,rightValue:i})}(e,t,r)})}function u(e,t){if(!e||!t)return null;let r=t.split("."),l=e;for(let e of r)if(!l||"object"!=typeof l||!(e in l))return null;else l=l[e];return l}var h=r(7204),f=r(7650);function m(e){let{isOpen:t,fieldName:r,fieldPath:n,leftArray:i,rightArray:a,leftVersion:o,rightVersion:c,leftCellLine:d,rightCellLine:u,onClose:h}=e;(0,s.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&h()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,h]),(0,s.useEffect)(()=>{if(!t)return;let e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[t]);let m=(0,s.useCallback)(e=>{e.target===e.currentTarget&&h()},[h]),x=(0,s.useCallback)(()=>(function(e,t){let r={added:[],removed:[],modified:[],unchanged:[],summary:{totalChanges:0,addedCount:0,removedCount:0,modifiedCount:0}},l=Math.max(e.length,t.length);for(let s=0;s<l;s++){let l=e[s],n=t[s],i=s<e.length,a=s<t.length;!i&&a?(r.added.push({index:s,item:n}),r.summary.addedCount++):i&&!a?(r.removed.push({index:s,item:l}),r.summary.removedCount++):i&&a&&(function e(t,r){if(t===r)return!0;if(null==t||null==r)return t===r;if(typeof t!=typeof r)return!1;if("object"==typeof t){if(Array.isArray(t)!==Array.isArray(r))return!1;if(Array.isArray(t))return t.length===r.length&&t.every((t,l)=>e(t,r[l]));let l=Object.keys(t),s=Object.keys(r);return l.length===s.length&&l.every(l=>e(t[l],r[l]))}return!1}(l,n)?r.unchanged.push({leftIndex:s,rightIndex:s,item:l}):(r.modified.push({leftIndex:s,rightIndex:s,leftItem:l,rightItem:n}),r.summary.modifiedCount++))}return r.summary.totalChanges=r.summary.addedCount+r.summary.removedCount+r.summary.modifiedCount,r})(i||[],a||[]),[i,a])();if(!t)return null;let p=(0,l.jsx)("div",{className:"fixed z-[9999] inset-0",role:"dialog",tabIndex:-1,"aria-labelledby":"array-comparison-modal-title",onClick:m,style:{position:"fixed",top:0,left:"280px",right:0,bottom:0},children:(0,l.jsxs)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white border border-gray-200 shadow-2xl rounded-xl w-full max-w-6xl max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),style:{backgroundColor:"white"},children:[(0,l.jsx)("div",{className:"py-4 px-6 border-b border-gray-200",children:(0,l.jsx)("h3",{id:"array-comparison-modal-title",className:"text-lg text-gray-800",children:r})}),(0,l.jsx)("div",{className:"flex-1 p-6 overflow-hidden",children:(0,l.jsx)(g,{leftArray:i||[],rightArray:a||[],leftCellLine:d,leftVersion:o,rightCellLine:u,rightVersion:c,analysis:x})})]})});return(0,f.createPortal)(p,document.body)}function g(e){let{leftArray:t,rightArray:r,leftCellLine:s,leftVersion:n,rightCellLine:i,rightVersion:a,analysis:o}=e,c=Math.max(t.length,r.length);return(0,l.jsx)("div",{className:"array-diff-viewer h-full flex flex-col",children:(0,l.jsxs)("div",{className:"flex-1 grid grid-cols-2 gap-6 overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex flex-col border border-gray-200 rounded-lg",children:[(0,l.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200 rounded-t-lg",children:(0,l.jsxs)("h4",{className:"text-sm font-semibold text-gray-700",children:[s," (v",n,")"]})}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,l.jsx)(x,{items:t,analysis:o,side:"left",maxLength:c})})]}),(0,l.jsxs)("div",{className:"flex flex-col border border-gray-200 rounded-lg",children:[(0,l.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200 rounded-t-lg",children:(0,l.jsxs)("h4",{className:"text-sm font-semibold text-gray-700",children:[i," (v",a,")"]})}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,l.jsx)(x,{items:r,analysis:o,side:"right",maxLength:c})})]})]})})}function x(e){let{items:t,analysis:r,side:s,maxLength:n}=e,i=e=>r.added.some(t=>t.index===e)&&"right"===s?"added":r.removed.some(t=>t.index===e)&&"left"===s?"removed":("left"===s?r.modified.some(t=>t.leftIndex===e):r.modified.some(t=>t.rightIndex===e))?"modified":("left"===s?r.unchanged.some(t=>t.leftIndex===e):r.unchanged.some(t=>t.rightIndex===e),"unchanged");return(0,l.jsx)("div",{className:"array-item-list p-2",children:Array.from({length:n},(e,r)=>{let s=t[r],n=i(r),a=void 0===s;return(0,l.jsxs)("div",{className:"array-item flex items-start gap-3 p-3 mb-2 rounded-md border ".concat(function(e,t){if(t)return"border-gray-200 bg-gray-50";switch(e){case"added":return"border-green-200 bg-green-50";case"removed":return"border-red-200 bg-red-50";case"modified":return"border-orange-200 bg-orange-50";default:return"border-gray-200 bg-white"}}(n,a)),children:[(0,l.jsxs)("span",{className:"item-index text-xs font-mono text-gray-500 flex-shrink-0 min-w-[40px]",children:["[",r,"]:"]}),(0,l.jsx)("div",{className:"item-content flex-1 text-sm",children:a?(0,l.jsx)("span",{className:"text-gray-400 italic",children:"[Not present]"}):(0,l.jsx)(p,{item:s})}),"unchanged"!==n&&!a&&(0,l.jsx)(y,{type:n})]},r)})})}function p(e){let{item:t}=e;return(0,l.jsx)("pre",{className:"whitespace-pre-wrap font-mono text-xs leading-relaxed",children:null==t?"[NOT SET]":"string"==typeof t?t:"object"==typeof t?JSON.stringify(t,null,2):String(t)})}function y(e){let{type:t}=e,r={added:{text:"Added",class:"bg-green-100 text-green-800"},removed:{text:"Removed",class:"bg-red-100 text-red-800"},modified:{text:"Modified",class:"bg-orange-100 text-orange-800"},unchanged:{text:"Unchanged",class:"bg-gray-100 text-gray-600"}},s=r[t]||r.unchanged;return(0,l.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(s.class),children:s.text})}function b(e){if(null==e||""===e)return"";if("string"==typeof e)return e;if("number"==typeof e)return e.toString();if("boolean"==typeof e)return e?"true":"false";if(Array.isArray(e))return 0===e.length?"[]":"[".concat(e.length," items]");if("object"==typeof e){let t=Object.keys(e);if(0===t.length)return"{}";if(t.length<=3){let r=t.map(t=>{let r=e[t],l="string"==typeof r?r:String(r);return"".concat(t,": ").concat(l)}).join(", ");return"{ ".concat(r," }")}return"{".concat(t.length," fields}")}return String(e)}let v=e=>{let[t,r]=(0,s.useState)(new Set(e||[])),l=(0,s.useCallback)(e=>{r(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),n=(0,s.useCallback)(e=>t.has(e),[t]),i=(0,s.useCallback)(()=>{r(new Set)},[]);return{expandedFields:t,toggleExpansion:l,isExpanded:n,expandAll:i,collapseAll:(0,s.useCallback)(()=>{r(new Set)},[]),setExpanded:(0,s.useCallback)((e,t)=>{r(r=>{let l=new Set(r);return t?l.add(e):l.delete(e),l})},[])}};var j=r(2415);class C{async getVersion(e,t){let r="".concat(e,":").concat(t),l=this.versionCache.get(r);if(l)return this.versionHits++,l.data;this.versionMisses++;let s=this.fetchPromises.get(r);if(s)return s;let n=this.fetchVersionFromAPI(e,t).then(e=>(this.versionCache.set(r,{data:e,timestamp:Date.now()}),this.fetchPromises.delete(r),e)).catch(e=>{throw this.fetchPromises.delete(r),e});return this.fetchPromises.set(r,n),n}getDiff(e,t){let r=this.getDiffCacheKey(e,t),l=this.diffCache.get(r);return l?(this.diffHits++,l.diff):(this.diffMisses++,null)}setDiff(e,t,r){let l=this.getDiffCacheKey(e,t);this.diffCache.set(l,{diff:r,timestamp:Date.now()})}getSchema(e){let t=this.schemaCache.get(e);return t&&Date.now()-t.timestamp<36e5?t.schema:null}setSchema(e,t){this.schemaCache.set(e,{schema:t,timestamp:Date.now()})}invalidateVersion(e,t){if(!e)return void this.versionCache.clear();if(t){let r="".concat(e,":").concat(t);this.versionCache.delete(r),this.fetchPromises.delete(r)}else{let t=[];for(let r of this.versionCache.keys())r.startsWith("".concat(e,":"))&&t.push(r);t.forEach(e=>{this.versionCache.delete(e),this.fetchPromises.delete(e)})}this.invalidateDiffByVersion(t||e)}invalidateDiffByVersion(e){let t=[];for(let r of this.diffCache.keys())r.includes(e)&&t.push(r);t.forEach(e=>this.diffCache.delete(e))}getStats(){let e=this.versionHits+this.versionMisses,t=this.diffHits+this.diffMisses;return{versionCache:{size:this.versionCache.size,maxSize:this.versionCache.max,hitCount:this.versionHits,missCount:this.versionMisses,hitRate:e>0?this.versionHits/e:0},diffCache:{size:this.diffCache.size,maxSize:this.diffCache.max,hitCount:this.diffHits,missCount:this.diffMisses,hitRate:t>0?this.diffHits/t:0},totalMemoryUsage:this.versionCache.calculatedSize+this.diffCache.calculatedSize}}clearAll(){this.versionCache.clear(),this.diffCache.clear(),this.schemaCache.clear(),this.fetchPromises.clear(),this.versionHits=0,this.versionMisses=0,this.diffHits=0,this.diffMisses=0}getDiffCacheKey(e,t){return[e,t].sort().join(":")}async fetchVersionFromAPI(e,t){let r=await fetch("http://localhost:8000/api/editor/celllines/".concat(e,"/versions/").concat(t,"/"));if(!r.ok)throw Error("Failed to fetch version: ".concat(r.statusText));let l=await r.json();return l.metadata||l}cleanup(){let e=Date.now();for(let[t,r]of this.schemaCache.entries())e-r.timestamp>36e5&&this.schemaCache.delete(t);.1>Math.random()&&(this.versionHits=Math.floor(.9*this.versionHits),this.versionMisses=Math.floor(.9*this.versionMisses),this.diffHits=Math.floor(.9*this.diffHits),this.diffMisses=Math.floor(.9*this.diffMisses))}constructor(e=50,t=30,r=6e5){this.versionHits=0,this.versionMisses=0,this.diffHits=0,this.diffMisses=0,this.versionCache=new j.A({max:e,ttl:r,sizeCalculation:e=>2*JSON.stringify(e.data).length,maxSize:0x6400000}),this.diffCache=new j.A({max:t,ttl:r,sizeCalculation:e=>2*JSON.stringify(e.diff).length,maxSize:0x3200000}),this.schemaCache=new Map,this.fetchPromises=new Map,setInterval(()=>this.cleanup(),6e4)}}let N=new C;class w{startTiming(e,t){if(!this.isEnabled)return()=>0;let r=performance.now(),l="".concat(e,"_").concat(Date.now(),"_").concat(Math.random());return this.timingStack.set(l,r),()=>{let s=performance.now()-r;return this.timingStack.delete(l),this.recordTiming(e,s,t),s}}recordTiming(e,t,r){this.isEnabled&&(this.entries.push({timestamp:Date.now(),operation:e,duration:t,metadata:r}),this.operationCounts.set(e,(this.operationCounts.get(e)||0)+1),this.entries.length>this.maxEntries&&(this.entries=this.entries.slice(-this.maxEntries)),this.checkPerformanceWarnings(e,t))}getAverageTiming(e,t){let r=t?Date.now()-t:0,l=this.entries.filter(t=>t.operation===e&&t.timestamp>r);return 0===l.length?0:l.reduce((e,t)=>e+t.duration,0)/l.length}getPercentiles(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[50,90,95,99],r=this.entries.filter(t=>t.operation===e).map(e=>e.duration).sort((e,t)=>e-t),l={};return t.forEach(e=>{let t=Math.ceil(e/100*r.length)-1;l[e]=r[t]||0}),l}getCurrentMetrics(){return Date.now(),{versionLoadTime:this.getAverageTiming("versionLoad",6e4),diffComputeTime:this.getAverageTiming("diffCompute",6e4),renderTime:this.getAverageTiming("render",6e4),memoryUsage:this.getCurrentMemoryUsage(),cacheHitRate:this.getCacheHitRate(),scrollPerformance:this.getAverageTiming("scroll",6e4),filterTime:this.getAverageTiming("filter",6e4),componentMountTime:this.getAverageTiming("componentMount",6e4)}}getBenchmarks(){let e=this.getCurrentMetrics();return Object.entries(this.benchmarks).map(t=>{let[r,l]=t,s=e[r]||0,n="pass";return s>1.5*l?n="fail":s>l&&(n="warning"),{name:r,target:l,current:s,status:n}})}recordMemoryUsage(){if(!this.isEnabled)return;let e=performance.memory;e&&this.recordTiming("memoryUsage",e.usedJSHeapSize/1024/1024,{totalHeapSize:e.totalJSHeapSize/1024/1024,heapSizeLimit:e.jsHeapSizeLimit/1024/1024})}getCurrentMemoryUsage(){let e=performance.memory;return e?e.usedJSHeapSize/1024/1024:0}mark(e){this.isEnabled&&"undefined"!=typeof performance&&performance.mark&&performance.mark(e)}measure(e,t,r){if(!this.isEnabled)return 0;try{if("undefined"!=typeof performance&&performance.measure){performance.measure(e,t,r);let l=performance.getEntriesByName(e,"measure"),s=l[l.length-1];if(s)return this.recordTiming(e,s.duration),s.duration}}catch(e){console.warn("Performance measurement failed:",e)}return 0}getSummary(e){let t=e?Date.now()-e:0,r=this.entries.filter(e=>e.timestamp>t),l=new Map;r.forEach(e=>{let t=l.get(e.operation)||{total:0,count:0};t.total+=e.duration,t.count+=1,l.set(e.operation,t)});let s=Array.from(l.entries()).map(e=>{let[t,r]=e;return{operation:t,avgTime:r.total/r.count}}).sort((e,t)=>t.avgTime-e.avgTime).slice(0,5),n=r.filter(e=>"memoryUsage"===e.operation).slice(-10).map(e=>e.duration);return{totalOperations:r.length,averageResponseTime:r.reduce((e,t)=>e+t.duration,0)/r.length||0,worstPerformers:s,memoryTrend:n,cacheEfficiency:this.getCacheHitRate()}}clear(){this.entries=[],this.operationCounts.clear(),this.timingStack.clear()}exportData(){return[...this.entries]}checkPerformanceWarnings(e,t){let r=this.benchmarks[e];r&&t>1.5*r&&console.warn("\uD83D\uDEA8 Performance Warning: ".concat(e," took ").concat(t.toFixed(2),"ms (target: ").concat(r,"ms)"))}getCacheHitRate(){try{return globalThis.__CACHE_HIT_RATE__||0}catch(e){return 0}}setupPerformanceObserver(){if("undefined"!=typeof PerformanceObserver)try{new PerformanceObserver(e=>{for(let t of e.getEntries())"paint"===t.entryType&&this.recordTiming("paint_".concat(t.name),t.startTime)}).observe({entryTypes:["paint"]})}catch(e){console.warn("Performance observer setup failed:",e)}}constructor(e=!1){this.entries=[],this.maxEntries=1e3,this.timingStack=new Map,this.operationCounts=new Map,this.benchmarks={versionLoadTime:500,diffComputeTime:200,renderTime:300,versionSwitching:200,scrollPerformance:16,filterTime:100},this.isEnabled=e,this.isEnabled&&(this.setupPerformanceObserver(),setInterval(()=>this.recordMemoryUsage(),5e3))}}let S=new w,L={cacheSettings:{versionCacheSize:50,diffCacheSize:30,cacheTTL:6e5,maxMemoryUsage:0x9600000},virtualScrolling:{enabled:!0,itemHeight:60,overscan:5,bufferSize:10},debouncing:{versionSelectionDelay:300,filterDelay:150,searchDelay:200,scrollDelay:16},performance:{enableMonitoring:!1,enablePerfWarnings:!0,maxPerformanceEntries:1e3,memoryCheckInterval:5e3},targets:{versionLoadTime:500,diffComputeTime:200,renderTime:300,versionSwitching:200,scrollPerformance:16,filterTime:100,memoryUsage:200}},E={...L,cacheSettings:{...L.cacheSettings,versionCacheSize:30,diffCacheSize:20,maxMemoryUsage:0x6400000},performance:{...L.performance,enableMonitoring:!1,enablePerfWarnings:!1,maxPerformanceEntries:500},virtualScrolling:{...L.virtualScrolling,overscan:3,bufferSize:5}};function k(){return E}function T(){let[e,t]=(0,s.useState)(()=>N.getStats()),[r,l]=(0,s.useState)(()=>S.getCurrentMetrics()),[n,i]=(0,s.useState)([]),a=(0,s.useRef)(E),o=(0,s.useRef)(),c=a.current.targets.memoryUsage;(0,s.useEffect)(()=>{let e=()=>{let e=N.getStats(),r=S.getCurrentMetrics();t(e),l(r);let s=(e.versionCache.hitRate+e.diffCache.hitRate)/2;globalThis.__CACHE_HIT_RATE__=s,i(function(e,t){let r=[];return e.versionCache.hitRate<.8&&r.push("Version cache hit rate is low. Consider pre-loading frequently accessed versions."),e.diffCache.hitRate<.9&&r.push("Diff cache hit rate is low. Users may be comparing many unique version pairs."),t.versionLoadTime>E.targets.versionLoadTime&&r.push("Version loading is slow. Check network conditions or API performance."),t.diffComputeTime>E.targets.diffComputeTime&&r.push("Diff computation is slow. Consider optimizing diff algorithm or reducing field count."),t.renderTime>E.targets.renderTime&&r.push("Rendering is slow. Consider enabling virtualization or reducing DOM complexity."),t.memoryUsage>E.targets.memoryUsage&&r.push("Memory usage is high. Consider clearing caches or reducing cache sizes."),e.totalMemoryUsage>0x6400000&&r.push("Cache memory usage is high. Consider reducing cache sizes or TTL."),r}(e,r))};return e(),o.current=setInterval(e,3e4),()=>{o.current&&clearInterval(o.current)}},[]);let d=(0,s.useCallback)(()=>{let e=r.memoryUsage;e>c&&(N.clearAll(),window.gc&&window.gc(),console.log("\uD83E\uDDF9 Memory optimization: Cleared caches (was ".concat(e.toFixed(1),"MB)")))},[r.memoryUsage,c]),u=(0,s.useMemo)(()=>({clearCache:()=>{N.clearAll(),t(N.getStats())},invalidateVersion:(e,r)=>{N.invalidateVersion(e,r),t(N.getStats())},optimizeMemory:d,getCachedVersion:async(e,t)=>{let r=S.startTiming("versionLoad",{cellLineId:e,versionId:t,source:"cache"});try{let l=await N.getVersion(e,t);return r(),l}catch(e){throw r(),e}},getCachedDiff:(e,t)=>{let r=S.startTiming("diffLoad",{leftVersionId:e,rightVersionId:t,source:"cache"}),l=N.getDiff(e,t);return r(),l},setCachedDiff:(e,r,l)=>{N.setDiff(e,r,l),t(N.getStats())}}),[d]);return[{isOptimized:(0,s.useMemo)(()=>{let t=e.versionCache.hitRate,l=e.diffCache.hitRate,s=r.memoryUsage<c,n=r.versionLoadTime<a.current.targets.versionLoadTime&&r.diffComputeTime<a.current.targets.diffComputeTime&&r.renderTime<a.current.targets.renderTime;return t>.8&&l>.9&&s&&n},[e,r,c]),cacheStats:e,performanceMetrics:r,memoryUsage:r.memoryUsage,recommendations:n},u]}function A(e){let{diffResults:t,showDifferencesOnly:r,itemHeight:n=64,onFieldExpand:i,onFieldCollapse:a,isScrollLocked:o=!1,onScroll:c,scrollTop:d=0,leftCellLine:u,leftVersion:f,rightCellLine:m,rightVersion:g}=e,{toggleExpansion:x,isExpanded:p}=v(),{renderCount:y}=function(e){let t=(0,s.useRef)(0),r=(0,s.useRef)(0);return(0,s.useEffect)(()=>{let l=performance.now();return()=>{let s=performance.now()-l;t.current++,r.current=s,S.recordTiming("render_".concat(e),s,{renderCount:t.current})}},[e]),{renderCount:t.current,lastRenderTime:r.current}}("VirtualizedDiffViewer"),b=(0,s.useRef)(null),j=(0,s.useMemo)(()=>{let e=S.startTiming("filter",{totalResults:t.length,showDifferencesOnly:r});try{var l;let s=(l=t,r?l.filter(e=>"UNCHANGED"!==e.changeType&&"NOT_SET"!==e.changeType&&(!e.children||function e(t){return"UNCHANGED"!==t.changeType&&"NOT_SET"!==t.changeType||!!t.children&&t.children.some(t=>e(t))}(e))):l),n=e();return n>E.targets.filterTime&&console.warn("\uD83D\uDC0C Slow filter: ".concat(n.toFixed(2),"ms for ").concat(t.length," items")),s}catch(t){throw e(),t}},[t,r,E.targets.filterTime]),C=(0,s.useRef)(d),N=(0,s.useRef)(0);(0,s.useEffect)(()=>{C.current=d},[d]);let w=(0,s.useCallback)(e=>{let t=S.startTiming("fieldToggle",{fieldPath:e});try{let r=p(e);x(e),r&&a?a(e):!r&&i&&i(e),t()}catch(e){throw t(),e}},[p,x,a,i]),L=(0,s.useCallback)(e=>{let{scrollTop:t}=e;N.current=t,c&&!o&&c(t)},[c,o]),k=(0,s.useCallback)(e=>{let{index:t,style:s}=e,n=j[t];return n?(0,l.jsx)("div",{style:s,className:"virtual-row-container",children:(0,l.jsx)(D,{diffResult:n,isExpanded:p(n.fieldPath),onToggleExpansion:()=>w(n.fieldPath),showDifferencesOnly:r,indentLevel:0,isVirtualized:!0,leftCellLine:u,leftVersion:f,rightCellLine:m,rightVersion:g})}):null},[j,p,w,r,u,f,m,g]),T=(0,s.useCallback)(e=>{let t=String(e.leftValue||""),r=String(e.rightValue||"");return Math.max(t.length,r.length)>50},[]),A=(0,s.useCallback)(e=>{let t=j[e];if(!t)return 48;let r=p(t.fieldPath),l=48;if(Array.isArray(t.leftValue)||Array.isArray(t.rightValue))return 60;let s=String(t.leftValue||""),n=String(t.rightValue||"");T(t)&&(l=Math.max(l,M(s,n)));let i=e=>e&&"object"==typeof e&&!Array.isArray(e)&&Object.keys(e).length>0,a=i(t.leftValue),o=i(t.rightValue);if(a||o){let e=60;if(r){var c;e+=Math.min(30*((null==(c=t.children)?void 0:c.length)||0),160)}l=Math.max(l,e)}return l+8},[j,p,T]),M=(e,t)=>Math.max(64,32*Math.max(Math.ceil(e.length/60),Math.ceil(t.length/60))),V=(0,s.useMemo)(()=>"diff-list-variable",[]);return 0===j.length?(0,l.jsx)("div",{className:"flex items-center justify-center h-full bg-gray-50 rounded-lg border border-gray-200",children:(0,l.jsxs)("div",{className:"text-center text-gray-500",children:[(0,l.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,l.jsx)("p",{className:"text-sm font-medium",children:r?"No differences found":"No data to display"}),(0,l.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:r?"All fields are identical":"Select versions to compare"}),!1]})}):(0,l.jsx)("div",{className:"virtualized-diff-viewer bg-white relative pr-6",style:{width:"100%",height:"700px"},children:(0,l.jsx)("div",{style:{height:"100%"},children:(0,l.jsx)(h._m,{ref:b,height:700,width:"100%",itemCount:j.length,itemSize:A,onScroll:L,className:"diff-virtual-list",overscanCount:E.virtualScrolling.overscan,children:k},V)})})}L.cacheSettings,L.performance,L.targets;let D=s.memo(function e(t){let{diffResult:r,isExpanded:n=!1,onToggleExpansion:i,indentLevel:a=0,showDifferencesOnly:o,isVirtualized:c=!1,leftCellLine:d,leftVersion:u,rightCellLine:h,rightVersion:f}=t,{fieldPath:g,changeType:x,leftValue:p,rightValue:y,children:v}=r,j=g.split(".").pop()||g,C=Array.isArray(p)||Array.isArray(y),N=v&&v.length>0,w=e=>null==e||""===e,S=w(p)&&w(y),L=S?"diff-incomplete":function(e){switch(e){case"MODIFIED":return"diff-modified";case"ADDED":return"diff-added";case"REMOVED":return"diff-removed";case"NOT_SET":return"diff-not-set";default:return"diff-unchanged"}}(x),{modalState:E,openModal:k,closeModal:T}=function(e){let[t,r]=(0,s.useState)({isOpen:!1,fieldName:"",fieldPath:"",leftArray:[],rightArray:[],leftVersion:"",rightVersion:"",leftCellLine:"",rightCellLine:""});return{modalState:t,openModal:(0,s.useCallback)((t,l,s,n,i)=>{r({isOpen:!0,fieldPath:t,fieldName:n,leftArray:l||[],rightArray:s||[],leftVersion:(null==i?void 0:i.leftVersion)||(null==e?void 0:e.leftVersionId)||"Unknown",rightVersion:(null==i?void 0:i.rightVersion)||(null==e?void 0:e.rightVersionId)||"Unknown",leftCellLine:(null==i?void 0:i.leftCellLine)||(null==e?void 0:e.leftCellLineId)||"Unknown",rightCellLine:(null==i?void 0:i.rightCellLine)||(null==e?void 0:e.rightCellLineId)||"Unknown"})},[e]),closeModal:(0,s.useCallback)(()=>{r(e=>({...e,isOpen:!1}))},[])}}((0,s.useMemo)(()=>({leftVersionId:u||void 0,rightVersionId:f||void 0,leftCellLineId:d||void 0,rightCellLineId:h||void 0}),[u,f,d,h]));if(C){var A,D;let e=Array.isArray(p)?p:[],t=Array.isArray(y)?y:[],r=(A=e,D=t,!(Array.isArray(A)&&Array.isArray(D)&&A.length===D.length&&A.every((e,t)=>(function e(t,r){if(t===r)return!0;if(null==t||null==r)return t===r;if(typeof t!=typeof r)return!1;if("object"==typeof t){if(Array.isArray(t)!==Array.isArray(r))return!1;if(Array.isArray(t))return t.length===r.length&&t.every((t,l)=>e(t,r[l]));let l=Object.keys(t),s=Object.keys(r);return l.length===s.length&&l.every(l=>e(t[l],r[l]))}return!1})(e,D[t]))));return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"diff-field ".concat(L," ").concat(c?"virtualized-item":""),style:{marginLeft:"".concat(12*a,"px")},children:(0,l.jsx)("div",{className:"field-row p-2",children:(0,l.jsx)("div",{className:"field-layout",children:(0,l.jsxs)("div",{className:"field-content",children:[(0,l.jsx)("div",{className:"field-name-row",children:(0,l.jsxs)("span",{className:"field-name",children:[j," (Array)"]})}),(0,l.jsxs)("div",{className:"field-values-row",children:[(0,l.jsx)("div",{}),(0,l.jsx)("div",{}),(0,l.jsxs)("button",{onClick:()=>k(g,e,t,j),className:"field-value-container right-value w-full h-full flex justify-end items-center text-sm font-medium text-gray-900 hover:text-black hover:bg-blue-100 transition-all duration-150 focus:outline-none cursor-pointer",children:["View comparison →",r&&(0,l.jsxs)("span",{className:"ml-2 inline-flex items-center gap-1",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-orange-400 rounded-full"}),(0,l.jsx)("span",{className:"text-xs text-orange-600 font-medium",children:"Changes"})]})]})]})]})})})}),(0,l.jsx)(m,{isOpen:E.isOpen,fieldName:E.fieldName,fieldPath:E.fieldPath,leftArray:E.leftArray,rightArray:E.rightArray,leftVersion:E.leftVersion,rightVersion:E.rightVersion,leftCellLine:E.leftCellLine,rightCellLine:E.rightCellLine,onClose:T})]})}return(0,l.jsxs)("div",{className:"diff-field ".concat(L," ").concat(c?"virtualized-item":""," ").concat(S?"incomplete-field":""),style:{marginLeft:"".concat(12*a,"px")},children:[(0,l.jsx)("div",{className:"field-row p-2",children:(0,l.jsxs)("div",{className:"field-layout",children:[N&&(0,l.jsx)("div",{className:"expansion-section",children:(0,l.jsx)("button",{onClick:i,className:"expansion-indicator text-gray-600 hover:text-gray-800 focus:outline-none p-1","aria-label":n?"Collapse ".concat(j):"Expand ".concat(j),children:(0,l.jsx)("span",{className:"transform transition-transform duration-200 ".concat(n?"rotate-90":""),children:"▶"})})}),(0,l.jsxs)("div",{className:"field-content",children:[(0,l.jsx)("div",{className:"field-name-row",children:(0,l.jsx)("span",{className:"field-name ".concat(S?"text-gray-400":""),children:j})}),(0,l.jsxs)("div",{className:"field-values-row",children:[(0,l.jsx)("div",{}),(0,l.jsx)("div",{className:"field-value-container left-value",children:(0,l.jsx)("span",{className:"field-value field-text-content",children:b(p)})}),(0,l.jsx)("div",{className:"field-value-container right-value",children:(0,l.jsx)("span",{className:"field-value field-text-content",children:b(y)})})]})]})]})}),N&&n&&!c&&(0,l.jsx)("div",{className:"nested-children ml-6 border-l border-gray-200 pl-3",children:v.map(t=>(0,l.jsx)(e,{diffResult:t,indentLevel:a+1,showDifferencesOnly:o,isVirtualized:c,leftCellLine:d,leftVersion:u,rightCellLine:h,rightVersion:f},t.fieldPath))})]})},(e,t)=>{if(e.diffResult.fieldPath!==t.diffResult.fieldPath||e.diffResult.changeType!==t.diffResult.changeType||e.isExpanded!==t.isExpanded||e.showDifferencesOnly!==t.showDifferencesOnly)return!1;let r=e.diffResult.leftValue,l=t.diffResult.leftValue,s=e.diffResult.rightValue,n=t.diffResult.rightValue;return r===l&&s===n||(!(Array.isArray(r)&&Array.isArray(l))||r.length===l.length)&&(Array.isArray(s)&&Array.isArray(n)&&s.length!==n.length,!1)});var M=r(5964),V=r.n(M),O=r(1959),_=r.n(O);function R(e){let{isVisible:t=!1,onToggleVisibility:r}=e,[l]=T(),[n,i]=(0,s.useState)(S.getBenchmarks()),[a,o]=(0,s.useState)(S.getSummary(6e4));return(0,s.useEffect)(()=>{if(!t)return;let e=setInterval(()=>{i(S.getBenchmarks()),o(S.getSummary(6e4))},2e3);return()=>clearInterval(e)},[t]),null}function P(e){let{onComparisonReady:t,onDiffReady:r,className:i=""}=e,{cellLines:o}=a(),[c,u]=T(),{computeOptimizedDiff:h}=function(){let[,{getCachedDiff:e,setCachedDiff:t}]=T();return{computeOptimizedDiff:(0,s.useCallback)(async(r,l,s,n,i)=>{let a=e(s,n);if(a)return a;let o=S.startTiming("diffCompute",{leftVersionId:s,rightVersionId:n,fieldCount:Object.keys(r).length});try{let e=i(r,l);t(s,n,e);let a=o();return console.log("\uD83D\uDCCA Diff computed in ".concat(a.toFixed(2),"ms for ").concat(Object.keys(r).length," fields")),e}catch(e){throw o(),e}},[e,t])}}(),f=(0,s.useRef)(t),m=(0,s.useRef)(r),g=(0,s.useRef)(h);(0,s.useEffect)(()=>{f.current=t},[t]),(0,s.useEffect)(()=>{m.current=r},[r]),(0,s.useEffect)(()=>{g.current=h},[h]);let[x,p]=(0,s.useState)(!1),[y,b]=(0,s.useState)({leftCellLine:null,leftVersion:null,rightCellLine:null,rightVersion:null,isScrollLocked:!1,showDifferencesOnly:!1,isLoading:{leftPanel:!1,rightPanel:!1}}),[v,j]=(0,s.useState)([]),[C,N]=(0,s.useState)([]),[w,L]=(0,s.useState)(null),[k,D]=(0,s.useState)(null),[M,O]=(0,s.useState)(null),[P,I]=(0,s.useState)(null),F=o.map(e=>({id:e.CellLine_hpscreg_id,label:e.CellLine_hpscreg_id})),z=e=>e.map(e=>({id:e.version_number.toString(),label:"Version ".concat(e.version_number),subtitle:new Date(e.created_on).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})),[U,H]=function(e,t,r){let[l,n]=(0,s.useState)(!1),[i,a]=(0,s.useState)(!1),[o,c]=(0,s.useState)(!1),d=(0,s.useRef)(new Map);(0,s.useEffect)(()=>()=>{d.current.forEach(e=>e.abort()),d.current.clear()},[]);let u=(0,s.useMemo)(()=>V()((t,r,l)=>{if(!e)return;let s=S.startTiming("versionSwitching",{cellLineId:t,versionId:r,panel:l}),i="version_".concat(l),a=d.current.get(i);a&&a.abort();let o=new AbortController;d.current.set(i,o);try{n(!1),e(t,r,l);let a=s();console.log("⚡ Version switch completed in ".concat(a.toFixed(2),"ms")),d.current.delete(i)}catch(e){s(),console.error("Version selection failed:",e),d.current.delete(i)}},E.debouncing.versionSelectionDelay),[e,E.debouncing.versionSelectionDelay]),h=(0,s.useMemo)(()=>V()(e=>{if(!t)return;let r=S.startTiming("filter",{showDifferencesOnly:e});try{a(!1),t(e);let l=r();console.log("\uD83D\uDD0D Filter applied in ".concat(l.toFixed(2),"ms"))}catch(e){r(),console.error("Filter operation failed:",e)}},E.debouncing.filterDelay),[t,E.debouncing.filterDelay]),f=(0,s.useMemo)(()=>V()(e=>{},E.debouncing.searchDelay),[void 0,E.debouncing.searchDelay]),m=(0,s.useCallback)(e=>_()(()=>{let t=S.startTiming("scroll");try{e();let r=t();r>E.targets.scrollPerformance&&console.warn("\uD83D\uDCDC Slow scroll: ".concat(r.toFixed(2),"ms (target: ").concat(E.targets.scrollPerformance,"ms)"))}catch(e){t(),console.error("Scroll handler failed:",e)}},E.debouncing.scrollDelay),[E.debouncing.scrollDelay,E.targets.scrollPerformance]),g=(0,s.useCallback)((e,t,r)=>{n(!0),u(e,t,r)},[u]),x=(0,s.useCallback)(e=>{a(!0),h(e)},[h]),p=(0,s.useCallback)(e=>{c(!0),f(e)},[f]),y=(0,s.useCallback)(()=>{u.cancel(),h.cancel(),f.cancel(),d.current.forEach(e=>e.abort()),d.current.clear(),n(!1),a(!1),c(!1)},[u,h,f]),b=[l,i,o].filter(Boolean).length;return[{isVersionSelectionPending:l,isFilterPending:i,isSearchPending:o,pendingOperations:b},{debouncedVersionSelect:g,debouncedFilter:x,debouncedSearch:p,throttledScroll:m,cancelPendingOperations:y}]}((e,t,r)=>{J(e,t,r)},e=>{b(t=>({...t,showDifferencesOnly:e}))}),B=(0,s.useCallback)(async(e,t)=>{if(!e)return;let r=S.startTiming("fetchVersions",{cellLineId:e,panel:t});b(e=>({...e,isLoading:{...e.isLoading,["".concat(t,"Panel")]:!0}})),O(null);try{let l=await fetch("http://localhost:8000/api/editor/celllines/".concat(e,"/versions/"));if(!l.ok)throw Error("Failed to fetch versions: ".concat(l.statusText));let s=(await l.json()).versions||[];"left"===t?j(s):N(s);let n=r();console.log("\uD83D\uDCCB Fetched ".concat(s.length," versions in ").concat(n.toFixed(2),"ms"))}catch(e){r(),O(e instanceof Error?e.message:"Failed to fetch versions")}finally{b(e=>({...e,isLoading:{...e.isLoading,["".concat(t,"Panel")]:!1}}))}},[]),J=(0,s.useCallback)(async(e,t,r)=>{if(e&&t){b(e=>({...e,isLoading:{...e.isLoading,["".concat(r,"Panel")]:!0}})),O(null);try{let l=await u.getCachedVersion(e,t);"left"===r?L(l):D(l)}catch(e){O(e instanceof Error?e.message:"Failed to fetch version data")}finally{b(e=>({...e,isLoading:{...e.isLoading,["".concat(r,"Panel")]:!1}}))}}},[u]);(0,s.useCallback)(async(e,t,r)=>J(e,t,r),[J]);let W=(0,s.useCallback)((e,t)=>{b(r=>({...r,["".concat(e,"CellLine")]:t,["".concat(e,"Version")]:null})),"left"===e?(L(null),j([])):(D(null),N([])),B(t,e)},[B]),G=(0,s.useCallback)((e,t)=>{b(r=>({...r,["".concat(e,"Version")]:t}));let r="left"===e?y.leftCellLine:y.rightCellLine;r&&H.debouncedVersionSelect(r,t,e)},[y.leftCellLine,y.rightCellLine,H]);return(0,s.useCallback)(()=>{b(e=>({...e,isScrollLocked:!e.isScrollLocked}))},[]),(0,s.useCallback)(()=>{let e=!y.showDifferencesOnly;H.debouncedFilter(e)},[y.showDifferencesOnly,H]),(0,s.useCallback)(e=>{I(e),r&&r(e)},[r]),(0,s.useCallback)(e=>{O(e),I(null)},[]),(0,s.useEffect)(()=>{w&&k&&t&&t(w,k)},[w,k,t]),(0,s.useEffect)(()=>{w&&k&&y.leftVersion&&y.rightVersion?(I(null),(async()=>{try{let e=await g.current(w,k,"".concat(y.leftCellLine,":").concat(y.leftVersion),"".concat(y.rightCellLine,":").concat(y.rightVersion),d);I(e),f.current&&f.current(w,k),m.current&&m.current(e)}catch(e){console.error("Diff computation failed:",e),O("Failed to compute differences")}})()):I(null)},[w,k,y.leftVersion,y.rightVersion,y.leftCellLine,y.rightCellLine]),(0,l.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm h-full w-full flex flex-col ".concat(i),children:[(0,l.jsx)("div",{className:"border-b border-gray-200 px-6 py-4 flex-shrink-0",children:(0,l.jsx)("div",{className:"flex items-center justify-end",children:(0,l.jsx)("div",{className:"flex items-center space-x-3",children:(0,l.jsxs)("div",{className:"flex items-center bg-gray-100 rounded-lg p-1 gap-1",children:[(0,l.jsx)("button",{onClick:()=>H.debouncedFilter(!1),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-all duration-200 hover:ring-2 hover:ring-blue-500 hover:ring-opacity-50 hover:ring-offset-1 ".concat(y.showDifferencesOnly?"text-gray-600 hover:text-gray-900":"bg-white text-gray-900 shadow-sm"),children:"Show All"}),(0,l.jsxs)("button",{onClick:()=>H.debouncedFilter(!0),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-all duration-200 hover:ring-2 hover:ring-blue-500 hover:ring-opacity-50 hover:ring-offset-1 ".concat(y.showDifferencesOnly?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,l.jsx)("svg",{className:"w-4 h-4 mr-1.5 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Show Differences"]})]})})})}),M&&(0,l.jsx)("div",{className:"mx-6 mt-4 p-4 bg-red-50 border border-red-200 rounded-md flex-shrink-0",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsx)("p",{className:"text-sm text-red-800",children:M})}),(0,l.jsx)("div",{className:"ml-auto pl-3",children:(0,l.jsx)("button",{onClick:()=>O(null),className:"text-red-400 hover:text-red-600",children:(0,l.jsx)("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})})]})}),(0,l.jsx)("div",{className:"border-b border-gray-200 p-6 flex-shrink-0",children:(0,l.jsxs)("div",{className:"grid grid-cols-4 gap-6",children:[(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsx)(n,{label:"Select cell line:",placeholder:"Choose cell line...",options:F,value:y.leftCellLine,onChange:e=>W("left",e),searchable:!0})}),(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsx)(n,{label:"Select version:",placeholder:"Select version...",options:z(v),value:y.leftVersion,onChange:e=>G("left",e),disabled:!y.leftCellLine,isLoading:y.isLoading.leftPanel})}),(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsx)(n,{label:"Select cell line:",placeholder:"Choose cell line...",options:F,value:y.rightCellLine,onChange:e=>W("right",e),searchable:!0})}),(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsx)(n,{label:"Select version:",placeholder:"Select version...",options:z(C),value:y.rightVersion,onChange:e=>G("right",e),disabled:!y.rightCellLine,isLoading:y.isLoading.rightPanel})})]})}),(0,l.jsx)("div",{className:"diff-container flex-1 flex flex-col min-h-0 w-full px-0 pb-0",children:y.isLoading.leftPanel||y.isLoading.rightPanel?(0,l.jsx)("div",{className:"flex items-center justify-center flex-1",children:(0,l.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"}),"Loading version data..."]})}):w&&k&&P?(0,l.jsxs)("div",{className:"diff-viewer-container flex-1 flex flex-col bg-white border border-gray-200 rounded-lg min-h-0 w-full mx-6 mb-6",children:[(0,l.jsxs)("div",{className:"diff-header grid grid-cols-4 gap-6 p-4 pr-6 bg-gray-50 border-b border-gray-200 rounded-t-lg flex-shrink-0",children:[(0,l.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Field Name"}),(0,l.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"\xa0"}),(0,l.jsxs)("div",{className:"text-sm font-medium text-gray-700 text-center",children:[y.leftCellLine," (v",y.leftVersion,")"]}),(0,l.jsxs)("div",{className:"text-sm font-medium text-gray-700 text-center",children:[y.rightCellLine," (v",y.rightVersion,")"]})]}),(0,l.jsx)("div",{className:"flex-1 min-h-0",style:{height:"700px"},children:(0,l.jsx)(A,{diffResults:P,showDifferencesOnly:y.showDifferencesOnly,leftCellLine:y.leftCellLine,leftVersion:y.leftVersion,rightCellLine:y.rightCellLine,rightVersion:y.rightVersion})})]}):(0,l.jsx)("div",{className:"flex items-center justify-center flex-1",children:(0,l.jsxs)("div",{className:"text-center text-gray-500",children:[(0,l.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,l.jsx)("p",{className:"text-sm",children:"Select cell lines and versions to compare"}),(0,l.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Choose from the dropdowns above"})]})})}),(0,l.jsx)(R,{isVisible:x,onToggleVisibility:()=>p(!x)})]})}var I=r(9137),F=r.n(I),z=r(7784);function U(e){let{isOpen:t,fieldName:r,value:n,fieldSchema:i,onSave:a,onCancel:o}=e,[c,d]=(0,s.useState)((null==n?void 0:n.toString())||""),[u,h]=(0,s.useState)(null),f=(0,s.useRef)(null);(0,s.useEffect)(()=>{t&&(d((null==n?void 0:n.toString())||""),h(null))},[t,n]),(0,s.useEffect)(()=>{if(t&&f.current){let e=setTimeout(()=>{if(f.current&&(f.current.focus(),"setSelectionRange"in f.current)){let e=f.current.value.length;f.current.setSelectionRange(e,e)}},100);return()=>clearTimeout(e)}},[t]),(0,s.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&o()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,o]);let m=e=>i?i.required&&""===e.trim()?"This field is required":i.max_length&&e.length>i.max_length?"Maximum length is ".concat(i.max_length," characters"):"IntegerField"===i.type&&isNaN(parseInt(e,10))?"Must be a valid integer":null:null,g=()=>{let e=m(c);if(e)return void h(e);let t=c;if(i)switch(i.type){case"IntegerField":t=parseInt(c,10);break;case"BooleanField":t="true"===c||"1"===c;break;case"JSONField":try{t=JSON.parse(c)}catch(e){h("Invalid JSON format");return}break;default:t=c}a(t)},x=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g())};return t?(0,l.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50",onClick:e=>{e.target===e.currentTarget&&o()},children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4",children:[(0,l.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:r}),(null==i?void 0:i.help_text)&&(0,l.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:i.help_text})]}),(0,l.jsx)("div",{className:"px-6 py-4",children:(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Value"}),(null==i?void 0:i.choices)&&i.choices.length>0?(0,l.jsxs)("select",{ref:f,value:c,onChange:e=>d(e.target.value),onKeyDown:x,className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-xs focus:outline-none",children:[(0,l.jsx)("option",{value:"",children:"Select..."}),i.choices.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}):(null==i?void 0:i.type)==="BooleanField"?(0,l.jsxs)("select",{ref:f,value:c,onChange:e=>d(e.target.value),onKeyDown:x,className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-xs focus:outline-none",children:[(0,l.jsx)("option",{value:"true",children:"True"}),(0,l.jsx)("option",{value:"false",children:"False"})]}):(null==i?void 0:i.type)==="JSONField"||c&&c.includes("\n")?(0,l.jsx)("textarea",{ref:f,value:c,onChange:e=>d(e.target.value),onKeyDown:x,className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-xs focus:outline-none resize-none",rows:Math.min(Math.max(c.split("\n").length+1,5),12),placeholder:"Enter value..."}):(0,l.jsx)("textarea",{ref:f,value:c,onChange:e=>d(e.target.value),onKeyDown:x,className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-xs focus:outline-none resize-none",rows:3,maxLength:null==i?void 0:i.max_length,placeholder:"Enter value..."}),u&&(0,l.jsx)("div",{className:"mt-2 text-sm text-red-600",children:u})]})})}),(0,l.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-lg",children:(0,l.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:["Press ",(0,l.jsx)("kbd",{className:"bg-gray-200 px-1 rounded",children:"Enter"})," to save • ",(0,l.jsx)("kbd",{className:"bg-gray-200 px-1 rounded",children:"Esc"})," to cancel"]})})]})}):null}function H(e){let{line:t,schema:r,isEditing:n,onToggleCollapse:i,onStartEdit:a,onCancelEdit:o,onUpdateValue:c,onAddItem:d}=e,[u,h]=(0,s.useState)(!1),f=()=>r[t.fieldPath[0]],m=()=>{let e=f(),r=t.value;return(null==e?void 0:e.type)==="BooleanField"?"text-purple-600 font-medium":(null==e?void 0:e.type)==="IntegerField"?"text-orange-600 font-medium":Array.isArray(r)?"text-green-600":"object"==typeof r&&null!==r?"text-indigo-600":"text-gray-900"},g=()=>{t.isEditable&&!n&&a()},x=()=>{t.isCollapsible&&i()};return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-12 text-right text-xs text-gray-500 bg-gray-50 border-r border-gray-200 py-1 px-2 select-none",children:t.lineNumber}),(0,l.jsx)("div",{className:"flex-1 py-1 px-3 min-h-[28px] flex items-center hover:bg-gray-50 border-l-2 border-transparent hover:border-blue-200 transition-colors",children:(0,l.jsx)("div",{style:{paddingLeft:"".concat(32*t.indentLevel,"px")},children:(()=>{let e=t.displayText.split(": "),r=e[0],s=e.slice(1).join(": ");return"array_control"===t.type?(0,l.jsx)("div",{className:"flex items-center text-green-600 cursor-pointer hover:text-green-800",title:"Add new item to array",onClick:d,children:(0,l.jsx)("span",{children:t.displayText})}):t.isCollapsible?(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("button",{onClick:x,className:"mr-2 text-gray-500 hover:text-gray-700 flex-shrink-0",children:t.isCollapsed?"▶":"▼"}),(0,l.jsxs)("span",{className:"text-blue-800 font-medium",children:[r,":"]})]}):t.isEditable&&void 0!==s?(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("span",{className:"text-blue-800 font-medium mr-1",children:[r,":"]}),(0,l.jsx)("span",{onClick:g,className:"cursor-pointer px-1 rounded border max-w-md truncate inline-block ".concat(u?"bg-blue-50 border-blue-200 text-blue-900":"hover:bg-gray-50 border-transparent"," ").concat(""===s.trim()?"text-gray-400 italic":m()),onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),title:""===s.trim()?"(empty)":s,children:""===s.trim()?"(empty)":s}),(0,l.jsx)(U,{isOpen:n,fieldName:r,value:t.value,fieldSchema:f(),onSave:e=>{console.log("\uD83D\uDFE1 EditorLine onSave called, fieldPath:",t.fieldPath,"newValue:",e),c(t.fieldPath,e)},onCancel:o})]}):(0,l.jsx)("span",{className:"text-gray-800",children:t.displayText})})()})}),t.validation&&(0,l.jsx)("div",{className:"px-2",children:(0,l.jsx)("span",{className:"text-sm ".concat("error"===t.validation.type?"text-red-500":"text-yellow-500"),title:t.validation.message,children:"error"===t.validation.type?"\uD83D\uDD34":"⚠️"})})]})}function B(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{current:1},n=[];function i(e,t,r,i){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6?arguments[6]:void 0,d={lineNumber:s.current++,type:e,fieldPath:t,displayText:r,isCollapsible:a,isCollapsed:!0,isEditable:o,value:i,indentLevel:void 0!==c?c:l};return n.push(d),d}return"object"==typeof e&&null!==e&&Object.entries(e).forEach(e=>{let[a,o]=e,c=[...r,a];if("  ".repeat(l),t[a],Array.isArray(o))i("object",c,"".concat(a),o,!0,!1,l),o.forEach((e,r)=>{let a=[...c,r.toString()];"object"==typeof e&&null!==e?(i("array_item",a,"".concat(r,":"),e,!0,!1,l+1),n.push(...B(e,t,a,l+2,s))):i("array_item",a,"".concat(r,": ").concat(e),e,!1,!0,l+1)}),i("array_control",[...c,"add"],"➕ Add Item",null,!1,!1,l+1);else if("object"==typeof o&&null!==o)i("object",c,"".concat(a),o,!0,!1,l),n.push(...B(o,t,c,l+1,s));else{let e=null==o?"":String(o);i("field",c,"".concat(a,": ").concat(e),o,!1,!0,l)}}),n}function J(){let{cellLines:e,selectedCellLine:t,isLoading:r,error:n,fetchCellLine:i,saveCellLine:o,setSelectedCellLine:c,refetch:d}=a(),{schema:u,isLoading:h,error:f}=function(){let[e,t]=(0,s.useState)(null),[r,l]=(0,s.useState)(!1),[n,i]=(0,s.useState)(null),a=(0,s.useCallback)(async()=>{l(!0),i(null);try{let e=await fetch("http://localhost:8000/api/editor/cellline-schema/");if(!e.ok)throw Error("Failed to fetch schema: ".concat(e.statusText));let r=await e.json();return t(r),r}catch(e){return i(e instanceof Error?e.message:"Failed to fetch schema"),console.error("Error fetching schema:",e),null}finally{l(!1)}},[]);return(0,s.useEffect)(()=>{a()},[a]),{schema:e,isLoading:r,error:n,refetch:a}}(),[m,g]=(0,s.useState)(""),[x,p]=(0,s.useState)([]),[y,b]=(0,s.useState)(null),[v,j]=(0,s.useState)(!1),[C,N]=(0,s.useState)(null),[w,S]=(0,s.useState)([]),[L,E]=(0,s.useState)(!1),[k,T]=(0,s.useState)(null),[A,D]=(0,s.useState)(""),M=(0,s.useMemo)(()=>t&&u?B(t,u):[],[t,u]);(0,s.useEffect)(()=>{p(M)},[M]),(0,s.useEffect)(()=>{d(A||void 0)},[A,d]),(0,s.useEffect)(()=>{t&&!k&&T(JSON.parse(JSON.stringify(t)))},[t,k]);let V=async t=>{if(console.log("\uD83D\uDD0D handleCellLineSelect called with cellLineId:",t),t){g(t),S([]),E(!1),T(null),N(null);let r=e.find(e=>e.CellLine_hpscreg_id===t);if(console.log("\uD83D\uDD0D Found existingCellLine:",!!r,"schema available:",!!u),r&&u){let e={id:r.CellLine_hpscreg_id,...r,template_name:r.CellLine_hpscreg_id};console.log("\uD83D\uDD0D Setting selectedCellLine to:",e),c(e),T(JSON.parse(JSON.stringify(e)));let t=B(e,u);p(t),console.log("\uD83D\uDD0D Generated",t.length,"display lines")}else console.log("\uD83D\uDD0D Fetching cell line from API..."),await i(t)}},O=async()=>{if(t){j(!0),N(null);try{await o(t.id,t),console.log("✅ Save successful")}catch(e){console.error("❌ Save failed:",e),N(e instanceof Error?e.message:"Failed to save cell line")}finally{j(!1)}}},_=e=>{p(t=>t.map(t=>t.lineNumber===e?{...t,isCollapsed:!t.isCollapsed}:t))},R=e=>{b(e)},P=()=>{b(null)},I=(e,r)=>{if(console.log("\uD83D\uDFE2 updateValue called with fieldPath:",e,"newValue:",r),console.log("\uD83D\uDFE2 Current selectedCellLine:",t?"EXISTS":"NULL"),console.log("\uD83D\uDFE2 selectedCellLine keys:",t?Object.keys(t).slice(0,5):"N/A"),t){console.log("\uD83D\uDFE2 selectedCellLine exists, creating deep copy..."),S(e=>[...e,JSON.parse(JSON.stringify(t))]),E(!0);let l=JSON.parse(JSON.stringify(t)),s=l;console.log("\uD83D\uDFE2 Navigating to field path...");for(let t=0;t<e.length-1;t++)s[e[t]]||(s[e[t]]={}),s=s[e[t]];let n=e[e.length-1];if(console.log("\uD83D\uDFE2 Setting field",n,"from",s[n],"to",r),s[n]=r,console.log("\uD83D\uDFE2 Updated object:",l),console.log("\uD83D\uDFE2 Calling setSelectedCellLine..."),c(l),u){console.log("\uD83D\uDFE2 Regenerating display lines...");let e=B(l,u);p(e),console.log("\uD83D\uDFE2 Display lines updated, count:",e.length)}}else console.log("❌ No selectedCellLine available");console.log("\uD83D\uDFE2 Setting editing line to null"),b(null)},U=e=>{let t=null==u?void 0:u[e];if(!(null==t?void 0:t.json_schema))return"";let r=t.json_schema;if("array"===r.type&&r.items){let e=r.items;if("object"===e.type&&e.properties){let t={};return Object.keys(e.properties).forEach(e=>{t[e]=""}),t}}return""},J=e=>{if(!t||!u)return;console.log("\uD83D\uDFE2 handleAddItem called with fieldPath:",e),S(e=>[...e,JSON.parse(JSON.stringify(t))]),E(!0);let r=e.slice(0,-1),l=r[0];console.log("\uD83D\uDFE2 Array field name:",l);let s=JSON.parse(JSON.stringify(t)),n=s;for(let e=0;e<r.length-1;e++)n=n[r[e]];let i=r[r.length-1];Array.isArray(n[i])||(n[i]=[]);let a=U(l);console.log("\uD83D\uDFE2 Adding new item:",a),n[i].push(a),c(s),p(B(s,u)),console.log("\uD83D\uDFE2 Array item added successfully")};return h||r?(0,l.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-800"}),(0,l.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading..."})]}):f?(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"text-red-800 font-medium",children:"Schema Error"}),(0,l.jsx)("p",{className:"text-red-700 text-sm mt-1",children:f})]}):n&&!t?(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"text-red-800 font-medium",children:"Loading Error"}),(0,l.jsx)("p",{className:"text-red-700 text-sm mt-1",children:n})]}):(0,l.jsxs)(z.t,{children:[(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 space-y-6",children:[C&&(0,l.jsx)("div",{className:"jsx-8b6c29b6f99345c4 bg-red-50 border border-red-200 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 flex items-start",children:[(0,l.jsx)("div",{className:"jsx-8b6c29b6f99345c4 flex-shrink-0",children:(0,l.jsx)("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"jsx-8b6c29b6f99345c4 h-5 w-5 text-red-400 mt-0.5",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd",className:"jsx-8b6c29b6f99345c4"})})}),(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 ml-3",children:[(0,l.jsx)("h3",{className:"jsx-8b6c29b6f99345c4 text-red-800 font-medium text-sm",children:"Save Failed"}),(0,l.jsx)("p",{className:"jsx-8b6c29b6f99345c4 text-red-700 text-sm mt-1",children:C}),(0,l.jsx)("p",{className:"jsx-8b6c29b6f99345c4 text-red-600 text-xs mt-2",children:"Please fix the issue and try saving again."})]})]}),(0,l.jsx)("button",{onClick:()=>{N(null)},title:"Dismiss error",className:"jsx-8b6c29b6f99345c4 ml-4 text-red-400 hover:text-red-600 transition-colors",children:(0,l.jsx)("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"jsx-8b6c29b6f99345c4 h-5 w-5",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd",className:"jsx-8b6c29b6f99345c4"})})})]})}),(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 flex items-center space-x-4",children:[(0,l.jsx)("label",{htmlFor:"curation-source-filter",className:"jsx-8b6c29b6f99345c4 text-sm font-medium text-gray-700",children:"Curation Source:"}),(0,l.jsx)("div",{className:"jsx-8b6c29b6f99345c4 relative",children:(0,l.jsxs)("select",{id:"curation-source-filter",value:A,onChange:e=>D(e.target.value),className:"jsx-8b6c29b6f99345c4 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 min-w-[150px]",children:[(0,l.jsx)("option",{value:"",className:"jsx-8b6c29b6f99345c4",children:"All Sources"}),(0,l.jsx)("option",{value:"hpscreg",className:"jsx-8b6c29b6f99345c4",children:"HPSCREG"}),(0,l.jsx)("option",{value:"LLM",className:"jsx-8b6c29b6f99345c4",children:"LLM Generated"}),(0,l.jsx)("option",{value:"institution",className:"jsx-8b6c29b6f99345c4",children:"Institution"}),(0,l.jsx)("option",{value:"manual",className:"jsx-8b6c29b6f99345c4",children:"Manual Entry"})]})}),(0,l.jsx)("label",{htmlFor:"cellline-select",className:"jsx-8b6c29b6f99345c4 text-sm font-medium text-gray-700",children:"Select Cell Line:"}),(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 relative",children:[(0,l.jsxs)("select",{id:"cellline-select",value:m,onChange:e=>V(e.target.value),className:"jsx-8b6c29b6f99345c4 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 min-w-[200px]",children:[(0,l.jsx)("option",{value:"",className:"jsx-8b6c29b6f99345c4",children:"Choose a cell line..."}),e.map(e=>(0,l.jsxs)("option",{value:e.CellLine_hpscreg_id||e.template_name,className:"jsx-8b6c29b6f99345c4",children:[e.CellLine_hpscreg_id||e.template_name,e.curation_source&&" (".concat(e.curation_source,")")]},e.CellLine_hpscreg_id||e.template_name))]}),e.length>0&&(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 text-xs text-gray-500 mt-1",children:[e.length," cell lines available"]})]}),(0,l.jsxs)("button",{onClick:()=>{console.log("Add cell line clicked")},title:"Create a new cell line",className:"jsx-8b6c29b6f99345c4 bg-green-600 hover:bg-green-700 text-white text-sm font-medium py-2 px-4 rounded-md transition-all shadow-sm hover:shadow flex items-center",children:[(0,l.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-8b6c29b6f99345c4 w-4 h-4 mr-2",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4",className:"jsx-8b6c29b6f99345c4"})}),"Add Cell Line"]})]}),m&&(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 flex items-center space-x-3",children:[(0,l.jsx)("button",{onClick:()=>{if(0===w.length)return;let e=w[w.length-1];S(e=>e.slice(0,-1)),E(w.length>1),c(e),u&&p(B(e,u)),console.log("\uD83D\uDD04 Undo performed, remaining history items:",w.length-1)},disabled:!L,title:L?"Undo last change (".concat(w.length," changes available)"):"No changes to undo",className:"jsx-8b6c29b6f99345c4 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-300 text-white text-sm font-medium py-2 px-4 rounded-md transition-all shadow-sm hover:shadow flex items-center",children:"Undo"}),(0,l.jsx)("button",{onClick:()=>{k&&(c(JSON.parse(JSON.stringify(k))),S([]),E(!1),u&&p(B(k,u)),console.log("\uD83D\uDD04 All changes reverted to original state"))},disabled:0===w.length,title:w.length>0?"Revert all changes back to original state":"No changes to revert",className:"jsx-8b6c29b6f99345c4 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-300 text-white text-sm font-medium py-2 px-4 rounded-md transition-all shadow-sm hover:shadow flex items-center",children:"Revert All"}),(0,l.jsx)("button",{onClick:O,disabled:v,className:"jsx-8b6c29b6f99345c4 bg-blue-800 hover:bg-blue-900 disabled:bg-blue-300 text-white text-sm font-medium py-2 px-4 rounded-md transition-all shadow-sm hover:shadow flex items-center",children:v?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"jsx-8b6c29b6f99345c4 animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"})]})]}),m&&x.length>0&&u?(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 border border-gray-200 rounded-lg overflow-hidden",children:[(0,l.jsxs)("div",{className:"jsx-8b6c29b6f99345c4 bg-gray-50 px-4 py-2 border-b border-gray-200",children:[(0,l.jsx)("h3",{className:"jsx-8b6c29b6f99345c4 text-sm font-medium text-gray-900",children:m}),(0,l.jsxs)("p",{className:"jsx-8b6c29b6f99345c4 text-xs text-gray-600 mt-1",children:[x.length," fields • Click values to edit"]})]}),(0,l.jsx)("div",{className:"jsx-8b6c29b6f99345c4 custom-editor bg-white",children:(function(e){let t=[],r=-1;for(let l=0;l<e.length;l++){let s=e[l];(!(r>=0)||!(s.indentLevel>r))&&(r>=0&&s.indentLevel<=r&&(r=-1),t.push(s),s.isCollapsed&&s.isCollapsible&&(r=s.indentLevel))}return t})(x).map(e=>(0,l.jsx)(H,{line:e,schema:u,isEditing:y===e.lineNumber,onToggleCollapse:()=>_(e.lineNumber),onStartEdit:()=>R(e.lineNumber),onCancelEdit:P,onUpdateValue:I,onAddItem:()=>J(e.fieldPath)},e.lineNumber))})]}):(0,l.jsx)("div",{className:"jsx-8b6c29b6f99345c4 text-center py-12 text-gray-500",children:(0,l.jsx)("p",{className:"jsx-8b6c29b6f99345c4",children:"Select a cell line to begin editing"})})]}),(0,l.jsx)(F(),{id:"8b6c29b6f99345c4",children:'.custom-editor.jsx-8b6c29b6f99345c4{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;font-size:14px;line-height:1.6;max-height:600px;overflow-y:auto;overscroll-behavior-y:contain}'})]})}function W(){return(0,l.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,l.jsx)("div",{className:"container mx-auto px-4 py-8 w-full",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,l.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-2",children:"Version Control Interface"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Compare cell line versions side-by-side"})]}),(0,l.jsx)(P,{})]}),(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-2",children:"Edit Cell Lines"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Select and edit cell line metadata"})]}),(0,l.jsx)(J,{})]})]})})})}function G(e){let{initialCellLineId:t}=e;return(0,l.jsx)(W,{})}},5731:(e,t,r)=>{"use strict";r.d(t,{S:()=>s});let l="http://web:8000",s={CURATION:{ARTICLES:"".concat(l,"/api/curation/articles/"),STATUS:"".concat(l,"/api/curation/status/"),BULK_CURATE:"".concat(l,"/api/curation/bulk_curate/"),ERROR_DETAILS:e=>"".concat(l,"/api/curation/").concat(e,"/error_details/")},EDITOR:{CELLLINES:"".concat(l,"/api/editor/celllines/"),CELLLINE:e=>"".concat(l,"/api/editor/celllines/").concat(e,"/"),SCHEMA:"".concat(l,"/api/editor/cellline-schema/"),NEW_TEMPLATE:"".concat(l,"/api/editor/celllines/new_template/"),VERSIONS:e=>"".concat(l,"/api/editor/celllines/").concat(e,"/versions/"),VERSION:(e,t)=>"".concat(l,"/api/editor/celllines/").concat(e,"/versions/").concat(t,"/")},TRANSCRIPTION:{ARTICLES:"".concat(l,"/api/articles/"),CREATE_ARTICLE:"".concat(l,"/api/transcription/create_article/")}}},7784:(e,t,r)=>{"use strict";r.d(t,{t:()=>n});var l=r(5155),s=r(2115);class n extends s.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Editor Error Boundary caught an error:",e,t)}render(){return this.state.hasError?(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 m-4",children:[(0,l.jsxs)("div",{className:"flex items-center mb-4",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Editor Error"}),(0,l.jsxs)("div",{className:"mt-2 text-sm text-red-700",children:[(0,l.jsx)("p",{children:"Something went wrong with the cell line editor. Please refresh the page or contact support if the problem persists."}),!1]})]})]}),(0,l.jsx)("div",{className:"flex",children:(0,l.jsx)("button",{onClick:()=>this.setState({hasError:!1}),className:"bg-red-100 hover:bg-red-200 text-red-800 text-sm font-medium py-2 px-4 rounded transition-colors",children:"Try Again"})})]}):this.props.children}constructor(e){super(e),this.state={hasError:!1}}}}},e=>{var t=t=>e(e.s=t);e.O(0,[919,441,684,358],()=>t(2636)),_N_E=e.O()}]);